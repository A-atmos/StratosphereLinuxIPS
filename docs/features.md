# Features

Slips is a behavioral-based IPS that uses machine learning to detect malicious behaviors in the network traffic. It is a modular software that can be extended. When Slips is run, it spawns several child processes to manage the I/O, to profile attackers and to run the detection modules.

Here we describe what Slips can take as input, what it produces as an output, and what detection modules are run on the traffic to detect malicious behaviour.

## Input

The input process reads flows of different types:

- Pcap files (internally using Zeek) 
- Packets directly from an interface (internally using Zeek)
- Suricata flows (from JSON files created by Suricata, such as eve.json)
- Argus flows (CSV file separated by commas or TABs) 
- Zeek/Bro flows from a Zeek folder with log files
- Nfdump flows from a binary nfdump file

All the input flows are converted to an internal format. So once read, Slips works the same with all of them. 

**_Note: look at ./slips.py --help to find correct argument to run Slips on each type of the file._**

## Output
The output process collects output from the modules and handles the display of information on screen. Currently, Slips' analysis and detected malicious behaviour can be analyzed as following:
	
- Kalipso - Node.JS based graphical user interface in the terminal. Kalipso displays Slips detection and analysis in colorful table and graphs, highlighting important detections. See section Kalipso for more explanation. 
- alerts.json and alerts.txt - collects all evidences and detections generated by Slips in a .txt and .json formats.
- log files in a folder _current-date-time_ - separates the traffic into files according to a profile and timewindow and summarize the traffic according to each profile and timewindow.

## Whitelisting
Slips allows you to whitelist some pieces of data in order to avoid its processing. In particular you can whitelist an IP address, a domain, or a complete organization. You can choose to whitelist what is going __to__ them and what is coming __from__ them. You can also choose to whitelist the flows, so they are not processed, or the alerts, so you see the flows but don't receive alerts on them. The idea of whitelisting is to avoid processing any communication to or from these pieces of data, not to avoid any packet that contains that piece of data. For example, if you whitelist the domain slack.com, then a DNS request to the DNS server 1.2.3.4 asking for slack.com will still be shown.

## Flows Whitelist
If you whitelist an IP address, Slips will check all flows and see if you are whitelisting to them or from them.

If you whitelist a domain, Slips will check:
- Domains in HTTP Host header
- Domains in the SNI field of TLS flows
- All the Domains in the DNS resolution of IPs (there can be many) (be careful that the resolution takes time, which means that some flows may not be whitelisted because Slips doesn't know they belong to a domain).
- Domains in the CN of the certificates in TLS

If you whitelist an organization, then:
- Every IP is checked against all the known IP ranges of that organization
- Every domain (SNI/HTTP Host/IP Resolution/TLS CN certs) is checked against all the known domains of that organization
- ASNs of every IP are verified against the known ASN of that organization

## Alerts Whitelist

If you whitelist some piece of data not to generate alerts, the process is the following:
- If you whitelisted an IP
    - We check if the source or destination IP of the flow that generated that alert is whitelisted.
    - We check if the content of the alert is related to the IP that is whitelisted.
- If you whitelisted a domain
    - We check if any domain in alerts related to DNS/HTTP Host/SNI is whitelisted. 
    - We check also if any domain in the traffic is a subdomain of your whitelisted domain. So if you whitelist 'test.com', we also match 'one.test.com'
- If you whitelisted an organization
    - We check that the ASN of the IP in the alert belongs to that organization.
    - We check that the range of the IP in the alert belongs to that organization.

## Whitelisting Example
You can modify the file ```whitelist.csv``` file with this content:


    "IoCType","IoCValue","Direction","IgnoreType"
    ip,1.2.3.4,both,alerts
    domain,google.com,src,flows
    domain,apple.com,both,both
    ip,94.23.253.72,both,alerts
    ip,91.121.83.118,both,alerts
    organization,microsoft,both,both
    organization,facebook,both,both
    organization,google,both,both
    organization,apple,both,both
    organization,twitter,both,both

The values for each column are the following:

    Column IoCType
        - Supported IoCTypes: ip, domain, organization
    Column IoCValue
        - Supported organizations: google, microsoft, apple, facebook, twitter.
    Column Direction
        - Direction: src, dst or both
            - Src: Check if the IoCValue is the source
            - Dst: Check if the IoCValue is the destination
            - Both: Check if the IoCValue is the source or destination
    Column IgnoreType
        - IgnoreType: alerts or flows or both
            - Ignore alerts: slips reads all the flows, but it just ignores alerting if there is a match.
            - Ignore flows: the flow will be completely discarded.

	

## Detection Modules

Modules are Python-based files that allow any developer to extend the functionality of Slips. They process and analyze data, perform additional detections and store data in Redis for other modules to consume. Currently, Slips has the following modules:


<style>
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
</style>


<table>
  <tr>
    <th>Module</th>
    <th>Description</th>
    <th>Status</th>
  </tr>
  <tr>
    <td>asn</td>
    <td>loads and finds the ASN of each IP</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>geoip</td>
    <td>finds the country and geolocation information of each IP</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>https</td>
    <td>training&test of RandomForest to detect malicious https flows</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>port scan detector</td>
    <td>detects Horizontal and Vertical port scans</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>threat intelligence</td>
    <td>checks if each IP is in a list of malicious IPs</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>timeline</td>
    <td>creates a timeline of what happened in the network based on all the flows and type of data available</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>rnn-cc-detection</td>
    <td>detects command and control channels using recurrent neural network and the stratosphere behavioral letters</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>VirusTotal</td>
    <td>module to lookup IP address on VirusTotal</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>flowalerts</td>
    <td>module to find malicious behaviour in each flow. Current measures are: long duration of the connection, successful ssh</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>blocking</td>
    <td>module to block malicious IPs connecting to the device</td>
    <td>⚠️</td>
  </tr>
  
</table>


## Usage Instructions

### Virustotal Module

To use this module you need to add your virustotal api key in ```modules/virustotal/api_key_secret```

### ExportingAlerts Module

To use this module to export to slack you need to add your slack bot token in  ```modules/ExportingAlerts/slack_bot_token_secret```

If you don't have a slack bot follow steps 1 to 3 [here](https://api.slack.com/bot-users#creating-bot-user) to get one.

---

If you want to contribute: improve existing Slips detection modules or implement your own detection modules, see section :doc:`Contributing <contributing>`.


